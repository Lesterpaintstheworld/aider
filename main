from aider import __version__, models
from aider.file_selector import select_relevant_files
from aider.file_utils import safe_read_files
from aider.coders import Coder
from aider.io import InputOutput

def main(io=None):
    if io is None:
        io = InputOutput()
    
    try:
        coder = Coder.create(io=io)  # Utilisez l'objet io passé en paramètre
        
        while True:
            io.tool_output("Appuyez sur Entrée pour continuer ou tapez 'exit' pour quitter.")
            user_input = io.user_input("")
            if user_input.lower() == 'exit':
                break
            coder.run(with_message="Continue to work on what you think should be done. Use your todolist, switch up things regularly")
            
            # Vérifier les nouveaux fichiers périodiquement
            if coder.check_for_new_files():
                io.tool_output("Les nouveaux fichiers ont été ajoutés au chat.")
    except Exception as e:
        io.tool_error(f"Une erreur s'est produite : {str(e)}")

if __name__ == "__main__":
    main()
